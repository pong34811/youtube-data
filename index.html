<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube API Config Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Login Section -->
    <div id="loginSection" class="min-h-screen flex items-center justify-center px-4">
        <div class="max-w-md w-full">
            <div class="bg-white rounded-2xl shadow-2xl p-8">
                <div class="text-center mb-8">
                    <div class="mx-auto w-16 h-16 bg-gradient-to-r from-red-500 to-red-600 rounded-full flex items-center justify-center mb-4">
                        <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                        </svg>
                    </div>
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">YouTube Dashboard</h1>
                    <p class="text-gray-600">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Gmail ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                </div>
                
                <form id="loginForm" class="space-y-6">
                    <div>
                        <label for="gmailInput" class="block text-sm font-medium text-gray-700 mb-2">
                            Gmail Address
                        </label>
                        <div class="relative">
                            <input type="email" id="gmailInput" required 
                                   placeholder="example@gmail.com"
                                   class="w-full px-4 py-3 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent transition duration-200">
                            <svg class="w-5 h-5 text-gray-400 absolute left-3 top-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"/>
                            </svg>
                        </div>
                    </div>

                    <button type="submit" id="loginButton"
                            class="w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-200 transform hover:scale-105 shadow-lg">
                        ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                    </button>
                </form>

                <div id="loginStatus" class="mt-4 hidden"></div>
            </div>
        </div>
    </div>

    <!-- Main Dashboard Section -->
    <div id="mainSection" class="hidden">
        <div class="container mx-auto px-4 py-8">
            <div class="max-w-6xl mx-auto">
                <!-- Header with Logout -->
                <div class="bg-white rounded-lg shadow-lg p-4 mb-8">
                    <div class="flex justify-between items-center">
                        <div class="flex space-x-4">
                            <button id="configTab" class="px-6 py-2 bg-blue-600 text-white rounded-lg font-medium">
                                ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Config
                            </button>
                            <button id="dashboardTab" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300">
                                ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î YouTube
                            </button>
                        </div>
                        <div class="flex items-center space-x-4">
                            <span id="userEmail" class="text-sm text-gray-600"></span>
                            <button id="logoutButton" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium transition duration-200">
                                ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Title -->
                <div class="text-center mb-8">
                    <h1 id="pageTitle" class="text-4xl font-bold text-gray-800 mb-2">YouTube API Config Manager</h1>
                    <p id="pageSubtitle" class="text-gray-600">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ YouTube API ‡πÅ‡∏ö‡∏ö Real-time</p>
                </div>

                <!-- Config Management Section -->
                <div id="configSection">
                    <!-- Add Config Form -->
                    <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                        <h2 class="text-2xl font-semibold text-gray-800 mb-6">‡πÄ‡∏û‡∏¥‡πà‡∏° Config ‡πÉ‡∏´‡∏°‡πà</h2>
                        <form id="configForm" class="space-y-4">
                            <div>
                                <label for="channelName" class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏≠‡∏á</label>
                                <input type="text" id="channelName" required 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            <div>
                                <label for="apiKey" class="block text-sm font-medium text-gray-700 mb-2">API Key</label>
                                <input type="text" id="apiKey" required 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            <div>
                                <label for="channelId" class="block text-sm font-medium text-gray-700 mb-2">Channel ID</label>
                                <input type="text" id="channelId" required 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            <button type="submit" 
                                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition duration-200">
                                ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Config
                            </button>
                        </form>
                    </div>

                    <!-- Config List -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h2 class="text-2xl font-semibold text-gray-800 mb-6">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ Config ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
                        <div id="configList" class="space-y-4">
                            <div class="text-center text-gray-500 py-8">
                                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"></div>
                                ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dashboard Section -->
                <div id="dashboardSection" class="hidden">
                    <!-- Channel Selector -->
                    <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                        <h2 class="text-2xl font-semibold text-gray-800 mb-6">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á YouTube</h2>
                        <div class="flex space-x-4">
                            <select id="channelSelector" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á...</option>
                            </select>
                            <button id="loadChannelData" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition duration-200">
                                ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                            </button>
                        </div>
                    </div>

                    <!-- Channel Info -->
                    <div id="channelInfo" class="bg-white rounded-lg shadow-lg p-6 mb-8 hidden">
                        <h2 class="text-2xl font-semibold text-gray-800 mb-6">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡πà‡∏≠‡∏á</h2>
                        <div id="channelDetails" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        </div>
                    </div>

                    <!-- Year Filter -->
                    <div id="yearFilterSection" class="bg-white rounded-lg shadow-lg p-6 mb-8 hidden">
                        <h2 class="text-2xl font-semibold text-gray-800 mb-6">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ</h2>
                        <div class="flex space-x-4">
                            <select id="yearSelector" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ...</option>
                            </select>
                            <button id="loadYearData" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-medium transition duration-200">
                                ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏µ
                            </button>
                        </div>
                    </div>

                    <!-- Analytics Dashboard -->
                    <div id="analyticsSection" class="space-y-8 hidden">
                        <!-- Performance Overview -->
                        <div class="bg-white rounded-lg shadow-lg p-6">
                            <h2 class="text-2xl font-semibold text-gray-800 mb-6">üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û</h2>
                            <div id="performanceOverview" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            </div>
                        </div>

                        <!-- Upload Pattern Analysis -->
                        <div class="bg-white rounded-lg shadow-lg p-6">
                            <h2 class="text-2xl font-semibold text-gray-800 mb-6">üìà ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î</h2>
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div>
                                    <h3 class="text-lg font-medium text-gray-700 mb-4">‡∏ß‡∏±‡∏ô‡πÉ‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</h3>
                                    <div id="weekdayChart" class="space-y-2">
                                    </div>
                                </div>
                                <div>
                                    <h3 class="text-lg font-medium text-gray-700 mb-4">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠</h3>
                                    <div id="consistencyMetrics" class="space-y-3">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Top Performing Videos -->
                        <div class="bg-white rounded-lg shadow-lg p-6">
                            <h2 class="text-2xl font-semibold text-gray-800 mb-6">üèÜ ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°</h2>
                            <div id="topVideos" class="space-y-4">
                            </div>
                        </div>

                        <!-- Content Analysis -->
                        <div class="bg-white rounded-lg shadow-lg p-6">
                            <h2 class="text-2xl font-semibold text-gray-800 mb-6">üí° ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤</h2>
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div>
                                    <h3 class="text-lg font-medium text-gray-700 mb-4">‡∏Ñ‡∏≥‡∏´‡∏•‡∏±‡∏Å‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°</h3>
                                    <div id="popularKeywords" class="space-y-2">
                                    </div>
                                </div>
                                <div>
                                    <h3 class="text-lg font-medium text-gray-700 mb-4">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</h3>
                                    <div id="titleLengthAnalysis" class="space-y-3">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Monthly Videos Table -->
                        <div class="bg-white rounded-lg shadow-lg p-6">
                            <h2 class="text-2xl font-semibold text-gray-800 mb-6">üìÖ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h2>
                            <div class="overflow-x-auto">
                                <table class="w-full table-auto">
                                    <thead>
                                        <tr class="bg-gray-50">
                                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</th>
                                            <th class="px-4 py-3 text-center text-sm font-medium text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</th>
                                            <th class="px-4 py-3 text-center text-sm font-medium text-gray-700">‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå</th>
                                            <th class="px-4 py-3 text-center text-sm font-medium text-gray-700">‡∏î‡∏π‡∏Ñ‡∏•‡∏¥‡∏õ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="monthlyVideosTable">
                                    </tbody>
                                </table>
                            </div>
                            <div id="yearSummary" class="mt-6 p-4 bg-blue-50 rounded-lg">
                            </div>
                        </div>
                    </div>

                    <!-- Monthly Videos Detail -->
                    <div id="monthlyVideosDetail" class="bg-white rounded-lg shadow-lg p-6 hidden">
                        <div class="flex justify-between items-center mb-6">
                            <h2 id="monthlyDetailTitle" class="text-2xl font-semibold text-gray-800">‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h2>
                            <button id="backToMonthlyTable" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium transition duration-200">
                                ‚Üê ‡∏Å‡∏•‡∏±‡∏ö
                            </button>
                        </div>
                        <div id="monthlyVideosList" class="space-y-4">
                        </div>
                    </div>
                </div>

                <!-- Status Display -->
                <div id="statusMessage" class="hidden mb-4 p-4 rounded-lg"></div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js';
        import { getDatabase, ref, push, onValue, remove, update, get } from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCWpAKdaReyNnzQoyUQUzyrQvZaO9OsQEg",
            authDomain: "prachayasittikul.firebaseapp.com",
            databaseURL: "https://prachayasittikul-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "prachayasittikul",
            storageBucket: "prachayasittikul.firebasestorage.app",
            messagingSenderId: "219834282197",
            appId: "1:219834282197:web:c2ca637ace643d8d2fb25c",
            measurementId: "G-LJJ9T60CJF"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const usersRef = ref(database, 'users');
        const configsRef = ref(database, 'youtube-configs');

        // DOM elements
        const loginSection = document.getElementById('loginSection');
        const mainSection = document.getElementById('mainSection');
        const loginForm = document.getElementById('loginForm');
        const gmailInput = document.getElementById('gmailInput');
        const loginButton = document.getElementById('loginButton');
        const loginStatus = document.getElementById('loginStatus');
        const logoutButton = document.getElementById('logoutButton');
        const userEmail = document.getElementById('userEmail');
        
        const configForm = document.getElementById('configForm');
        const configList = document.getElementById('configList');
        const statusMessage = document.getElementById('statusMessage');
        const configTab = document.getElementById('configTab');
        const dashboardTab = document.getElementById('dashboardTab');
        const configSection = document.getElementById('configSection');
        const dashboardSection = document.getElementById('dashboardSection');
        const pageTitle = document.getElementById('pageTitle');
        const pageSubtitle = document.getElementById('pageSubtitle');
        const channelSelector = document.getElementById('channelSelector');
        const loadChannelDataBtn = document.getElementById('loadChannelData');
        const channelInfo = document.getElementById('channelInfo');
        const channelDetails = document.getElementById('channelDetails');
        const yearFilterSection = document.getElementById('yearFilterSection');
        const yearSelector = document.getElementById('yearSelector');
        const loadYearDataBtn = document.getElementById('loadYearData');
        const analyticsSection = document.getElementById('analyticsSection');
        const performanceOverview = document.getElementById('performanceOverview');
        const weekdayChart = document.getElementById('weekdayChart');
        const consistencyMetrics = document.getElementById('consistencyMetrics');
        const topVideos = document.getElementById('topVideos');
        const popularKeywords = document.getElementById('popularKeywords');
        const titleLengthAnalysis = document.getElementById('titleLengthAnalysis');
        const monthlyVideosTable = document.getElementById('monthlyVideosTable');
        const yearSummary = document.getElementById('yearSummary');
        const monthlyVideosDetail = document.getElementById('monthlyVideosDetail');
        const monthlyDetailTitle = document.getElementById('monthlyDetailTitle');
        const monthlyVideosList = document.getElementById('monthlyVideosList');
        const backToMonthlyTableBtn = document.getElementById('backToMonthlyTable');

        let allConfigs = {};
        let currentChannelData = null;
        let currentConfig = null;
        let currentYearVideos = [];
        let currentSelectedYear = null;
        let currentUser = null;

        // Check if user is logged in
        function checkLogin() {
            const loggedInUser = localStorage.getItem('loggedInUser');
            if (loggedInUser) {
                currentUser = JSON.parse(loggedInUser);
                showMainSection();
            }
        }

        // Login handler
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = gmailInput.value.trim().toLowerCase();

            if (!email.endsWith('@gmail.com')) {
                showLoginStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Gmail ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                return;
            }

            loginButton.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...';
            loginButton.disabled = true;

            try {
                const snapshot = await get(usersRef);
                const users = snapshot.val();
                
                let userFound = false;
                if (users) {
                    Object.entries(users).forEach(([key, user]) => {
                        if (user.email && user.email.toLowerCase() === email) {
                            userFound = true;
                            currentUser = { id: key, ...user };
                        }
                    });
                }

                if (userFound) {
                    localStorage.setItem('loggedInUser', JSON.stringify(currentUser));
                    showLoginStatus('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                    setTimeout(() => {
                        showMainSection();
                    }, 500);
                } else {
                    showLoginStatus('‡πÑ‡∏°‡πà‡∏û‡∏ö Gmail ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö', 'error');
                }
            } catch (error) {
                console.error('Login error:', error);
                showLoginStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö', 'error');
            } finally {
                loginButton.textContent = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö';
                loginButton.disabled = false;
            }
        });

        // Logout handler
        logoutButton.addEventListener('click', () => {
            localStorage.removeItem('loggedInUser');
            currentUser = null;
            loginSection.classList.remove('hidden');
            mainSection.classList.add('hidden');
            gmailInput.value = '';
            showLoginStatus('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        });

        // Show login status
        function showLoginStatus(message, type) {
            loginStatus.className = `mt-4 p-3 rounded-lg text-sm text-center ${
                type === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
            }`;
            loginStatus.textContent = message;
            loginStatus.classList.remove('hidden');
            setTimeout(() => {
                loginStatus.classList.add('hidden');
            }, 3000);
        }

        // Show main section
        function showMainSection() {
            loginSection.classList.add('hidden');
            mainSection.classList.remove('hidden');
            userEmail.textContent = currentUser.email;
        }

        // Tab switching
        configTab.addEventListener('click', () => {
            configTab.className = 'px-6 py-2 bg-blue-600 text-white rounded-lg font-medium';
            dashboardTab.className = 'px-6 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300';
            configSection.classList.remove('hidden');
            dashboardSection.classList.add('hidden');
            pageTitle.textContent = 'YouTube API Config Manager';
            pageSubtitle.textContent = '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ YouTube API ‡πÅ‡∏ö‡∏ö Real-time';
        });

        dashboardTab.addEventListener('click', () => {
            dashboardTab.className = 'px-6 py-2 bg-blue-600 text-white rounded-lg font-medium';
            configTab.className = 'px-6 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300';
            dashboardSection.classList.remove('hidden');
            configSection.classList.add('hidden');
            pageTitle.textContent = '‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î YouTube';
            pageSubtitle.textContent = '‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡πà‡∏≠‡∏á YouTube ‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å';
            updateChannelSelector();
        });

        function showStatus(message, type = 'success') {
            statusMessage.className = `mb-4 p-4 rounded-lg ${type === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`;
            statusMessage.textContent = message;
            statusMessage.classList.remove('hidden');
            setTimeout(() => {
                statusMessage.classList.add('hidden');
            }, 3000);
        }

        function updateChannelSelector() {
            channelSelector.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á...</option>';
            Object.entries(allConfigs).forEach(([key, config]) => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = config.channelName;
                channelSelector.appendChild(option);
            });
        }

        async function fetchChannelData(apiKey, channelId) {
            const response = await fetch(`https://www.googleapis.com/youtube/v3/channels?part=snippet,statistics&id=${channelId}&key=${apiKey}`);
            const data = await response.json();
            if (data.error) throw new Error(data.error.message);
            return data.items[0];
        }

        async function fetchChannelVideosForYear(apiKey, channelId, year) {
            const startDate = new Date(year, 0, 1).toISOString();
            const endDate = new Date(year + 1, 0, 1).toISOString();
            let allVideos = [];
            let nextPageToken = '';
            
            do {
                const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${channelId}&type=video&order=date&publishedAfter=${startDate}&publishedBefore=${endDate}&maxResults=50&key=${apiKey}${nextPageToken ? '&pageToken=' + nextPageToken : ''}`;
                const response = await fetch(url);
                const data = await response.json();
                if (data.error) throw new Error(data.error.message);
                allVideos = allVideos.concat(data.items || []);
                nextPageToken = data.nextPageToken || '';
            } while (nextPageToken);
            
            return allVideos;
        }

        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }

        function generateYearOptions(channelCreatedDate) {
            const createdYear = new Date(channelCreatedDate).getFullYear();
            const currentYear = new Date().getFullYear();
            yearSelector.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ...</option>';
            
            for (let year = currentYear; year >= createdYear; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year + 543;
                if (year === currentYear) option.selected = true;
                yearSelector.appendChild(option);
            }
        }

        function analyzePerformance(videos) {
            const totalVideos = videos.length;
            const avgPerMonth = (totalVideos / 12).toFixed(1);
            const dates = videos.map(v => new Date(v.snippet.publishedAt)).sort((a, b) => a - b);
            let totalGaps = 0;
            for (let i = 1; i < dates.length; i++) {
                totalGaps += (dates[i] - dates[i-1]) / (1000 * 60 * 60 * 24);
            }
            const avgGap = dates.length > 1 ? (totalGaps / (dates.length - 1)).toFixed(1) : 0;
            const monthCounts = new Array(12).fill(0);
            videos.forEach(video => monthCounts[new Date(video.snippet.publishedAt).getMonth()]++);
            const maxMonthIndex = monthCounts.indexOf(Math.max(...monthCounts));
            const monthNames = ['‡∏°.‡∏Ñ.', '‡∏Å.‡∏û.', '‡∏°‡∏µ.‡∏Ñ.', '‡πÄ‡∏°.‡∏¢.', '‡∏û.‡∏Ñ.', '‡∏°‡∏¥.‡∏¢.', '‡∏Å.‡∏Ñ.', '‡∏™.‡∏Ñ.', '‡∏Å.‡∏¢.', '‡∏ï.‡∏Ñ.', '‡∏û.‡∏¢.', '‡∏ò.‡∏Ñ.'];
            
            return { totalVideos, avgPerMonth, avgGap, mostActiveMonth: monthNames[maxMonthIndex], mostActiveCount: monthCounts[maxMonthIndex] };
        }

        function analyzeWeekdayPattern(videos) {
            const weekdays = ['‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå', '‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå', '‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£', '‡∏û‡∏∏‡∏ò', '‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ', '‡∏®‡∏∏‡∏Å‡∏£‡πå', '‡πÄ‡∏™‡∏≤‡∏£‡πå'];
            const weekdayCounts = new Array(7).fill(0);
            videos.forEach(video => weekdayCounts[new Date(video.snippet.publishedAt).getDay()]++);
            const total = videos.length;
            return weekdays.map((day, index) => ({
                day, count: weekdayCounts[index],
                percentage: total > 0 ? ((weekdayCounts[index] / total) * 100).toFixed(1) : 0
            }));
        }

        function analyzeKeywords(videos) {
            const words = {};
            const commonWords = ['‡πÅ‡∏•‡∏∞', '‡πÉ‡∏ô', '‡∏ó‡∏µ‡πà', '‡πÄ‡∏õ‡πá‡∏ô', '‡∏°‡∏µ', '‡πÑ‡∏î‡πâ', '‡∏à‡∏∞', '‡πÑ‡∏õ', '‡∏°‡∏≤', '‡πÉ‡∏´‡πâ', '‡∏Ç‡∏≠‡∏á', '‡∏Å‡∏±‡∏ö', '‡∏Å‡πá', '‡πÑ‡∏°‡πà', '‡πÅ‡∏•‡πâ‡∏ß', '‡∏ß‡πà‡∏≤', '‡∏ñ‡πâ‡∏≤', '‡πÄ‡∏°‡∏∑‡πà‡∏≠', '‡∏ã‡∏∂‡πà‡∏á', '‡∏ô‡∏µ‡πâ', '‡∏ô‡∏±‡πâ‡∏ô', '‡∏≠‡∏¢‡πà‡∏≤‡∏á', '‡πÄ‡∏û‡∏∑‡πà‡∏≠', '‡∏ó‡∏≥', '‡πÉ‡∏ä‡πâ', '‡∏î‡∏π', '‡∏£‡∏π‡πâ', '‡πÄ‡∏≠‡∏≤', '‡∏Ç‡∏∂‡πâ‡∏ô', '‡∏•‡∏á', '‡∏≠‡∏≠‡∏Å', '‡πÄ‡∏Ç‡πâ‡∏≤'];
            videos.forEach(video => {
                const title = video.snippet.title.toLowerCase();
                const titleWords = title.split(/[\s\-_.,!?()[\]{}]+/).filter(word => 
                    word.length > 2 && !commonWords.includes(word) && !/^\d+$/.test(word)
                );
                titleWords.forEach(word => words[word] = (words[word] || 0) + 1);
            });
            return Object.entries(words).sort(([,a], [,b]) => b - a).slice(0, 10).map(([word, count]) => ({ word, count }));
        }

        function analyzeTitleLength(videos) {
            const lengths = videos.map(v => v.snippet.title.length);
            const avgLength = (lengths.reduce((a, b) => a + b, 0) / lengths.length).toFixed(1);
            const minLength = Math.min(...lengths);
            const maxLength = Math.max(...lengths);
            const short = lengths.filter(l => l < 30).length;
            const medium = lengths.filter(l => l >= 30 && l <= 60).length;
            const long = lengths.filter(l => l > 60).length;
            const total = lengths.length;
            return {
                avgLength, minLength, maxLength,
                categories: [
                    { range: '‡∏™‡∏±‡πâ‡∏ô (< 30 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)', count: short, percentage: ((short / total) * 100).toFixed(1) },
                    { range: '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (30-60 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)', count: medium, percentage: ((medium / total) * 100).toFixed(1) },
                    { range: '‡∏¢‡∏≤‡∏ß (> 60 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)', count: long, percentage: ((long / total) * 100).toFixed(1) }
                ]
            };
        }

        function getTopVideos(videos) {
            return videos.sort((a, b) => new Date(b.snippet.publishedAt) - new Date(a.snippet.publishedAt)).slice(0, 5);
        }

        function processMonthlyData(videos) {
            const monthNames = ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô', '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];
            const monthlyCount = new Array(12).fill(0);
            const monthlyVideos = Array.from({ length: 12 }, () => []);
            videos.forEach(video => {
                const month = new Date(video.snippet.publishedAt).getMonth();
                monthlyCount[month]++;
                monthlyVideos[month].push(video);
            });
            const totalVideos = videos.length;
            return monthNames.map((monthName, index) => ({
                month: monthName, monthIndex: index, count: monthlyCount[index],
                percentage: totalVideos > 0 ? ((monthlyCount[index] / totalVideos) * 100).toFixed(1) : 0,
                videos: monthlyVideos[index]
            }));
        }

        function displayAnalytics(videos) {
            const performance = analyzePerformance(videos);
            const weekdayPattern = analyzeWeekdayPattern(videos);
            const keywords = analyzeKeywords(videos);
            const titleAnalysis = analyzeTitleLength(videos);
            const topVideosList = getTopVideos(videos);

            performanceOverview.innerHTML = `
                <div class="bg-blue-50 p-4 rounded-lg text-center">
                    <h4 class="font-semibold text-blue-800 mb-1">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏õ‡∏µ</h4>
                    <p class="text-2xl font-bold text-blue-600">${performance.totalVideos}</p>
                    <p class="text-sm text-blue-500">‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</p>
                </div>
                <div class="bg-green-50 p-4 rounded-lg text-center">
                    <h4 class="font-semibold text-green-800 mb-1">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h4>
                    <p class="text-2xl font-bold text-green-600">${performance.avgPerMonth}</p>
                    <p class="text-sm text-green-500">‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</p>
                </div>
                <div class="bg-purple-50 p-4 rounded-lg text-center">
                    <h4 class="font-semibold text-purple-800 mb-1">‡∏ä‡πà‡∏ß‡∏á‡∏´‡πà‡∏≤‡∏á‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</h4>
                    <p class="text-2xl font-bold text-purple-600">${performance.avgGap}</p>
                    <p class="text-sm text-purple-500">‡∏ß‡∏±‡∏ô</p>
                </div>
                <div class="bg-orange-50 p-4 rounded-lg text-center">
                    <h4 class="font-semibold text-orange-800 mb-1">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏¢‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h4>
                    <p class="text-lg font-bold text-orange-600">${performance.mostActiveMonth}</p>
                    <p class="text-sm text-orange-500">${performance.mostActiveCount} ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</p>
                </div>
            `;

            weekdayChart.innerHTML = weekdayPattern.map(data => `
                <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                    <span class="text-sm font-medium text-gray-700">${data.day}</span>
                    <div class="flex items-center space-x-2">
                        <div class="w-20 bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-600 h-2 rounded-full" style="width: ${data.percentage}%"></div>
                        </div>
                        <span class="text-sm text-gray-600 w-12">${data.count}</span>
                    </div>
                </div>
            `).join('');

            consistencyMetrics.innerHTML = `
                <div class="bg-green-50 p-3 rounded-lg">
                    <h4 class="font-medium text-green-800">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠</h4>
                    <p class="text-sm text-green-600">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏∏‡∏Å ${performance.avgGap} ‡∏ß‡∏±‡∏ô‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</p>
                </div>
                <div class="bg-blue-50 p-3 rounded-lg">
                    <h4 class="font-medium text-blue-800">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏¢‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h4>
                    <p class="text-sm text-blue-600">${weekdayPattern.reduce((max, current) => current.count > max.count ? current : max).day}</p>
                </div>
                <div class="bg-purple-50 p-3 rounded-lg">
                    <h4 class="font-medium text-purple-800">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≠‡∏á</h4>
                    <p class="text-sm text-purple-600">${performance.mostActiveMonth} (${performance.mostActiveCount} ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠)</p>
                </div>
            `;

            topVideos.innerHTML = topVideosList.map((video, index) => `
                <div class="flex items-center space-x-4 p-3 bg-gray-50 rounded-lg">
                    <div class="flex-shrink-0">
                        <span class="inline-flex items-center justify-center w-8 h-8 bg-blue-600 text-white rounded-full text-sm font-bold">${index + 1}</span>
                    </div>
                    <div class="flex-shrink-0">
                        <img src="${video.snippet.thumbnails.default.url}" alt="${video.snippet.title}" class="w-16 h-12 object-cover rounded">
                    </div>
                    <div class="flex-1 min-w-0">
                        <h4 class="text-sm font-medium text-gray-800 line-clamp-2">${video.snippet.title}</h4>
                        <p class="text-xs text-gray-500 mt-1">${new Date(video.snippet.publishedAt).toLocaleDateString('th-TH')}</p>
                    </div>
                    <div class="flex-shrink-0">
                        <a href="https://www.youtube.com/watch?v=${video.id.videoId}" target="_blank" rel="noopener noreferrer" class="text-red-600 hover:text-red-700 text-sm font-medium">‡∏î‡∏π</a>
                    </div>
                </div>
            `).join('');

            popularKeywords.innerHTML = keywords.map(keyword => `
                <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                    <span class="text-sm font-medium text-gray-700">${keyword.word}</span>
                    <div class="flex items-center space-x-2">
                        <div class="w-16 bg-gray-200 rounded-full h-2">
                            <div class="bg-green-600 h-2 rounded-full" style="width: ${(keyword.count / keywords[0].count) * 100}%"></div>
                        </div>
                        <span class="text-sm text-gray-600 w-8">${keyword.count}</span>
                    </div>
                </div>
            `).join('');

            titleLengthAnalysis.innerHTML = `
                <div class="bg-blue-50 p-3 rounded-lg mb-3">
                    <h4 class="font-medium text-blue-800">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</h4>
                    <p class="text-lg font-bold text-blue-600">${titleAnalysis.avgLength} ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</p>
                    <p class="text-xs text-blue-500">‡∏™‡∏±‡πâ‡∏ô‡∏™‡∏∏‡∏î: ${titleAnalysis.minLength} | ‡∏¢‡∏≤‡∏ß‡∏™‡∏∏‡∏î: ${titleAnalysis.maxLength}</p>
                </div>
                ${titleAnalysis.categories.map(cat => `
                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded mb-1">
                        <span class="text-sm text-gray-700">${cat.range}</span>
                        <div class="flex items-center space-x-2">
                            <div class="w-12 bg-gray-200 rounded-full h-2">
                                <div class="bg-purple-600 h-2 rounded-full" style="width: ${cat.percentage}%"></div>
                            </div>
                            <span class="text-sm text-gray-600 w-8">${cat.count}</span>
                        </div>
                    </div>
                `).join('')}
            `;
        }

        function showMonthlyVideos(monthData) {
            monthlyDetailTitle.textContent = `‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô${monthData.month} ${currentSelectedYear + 543} (${monthData.count} ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠)`;
            
            if (monthData.videos.length === 0) {
                monthlyVideosList.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                        </svg>
                        ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ
                    </div>
                `;
            } else {
                monthlyVideosList.innerHTML = monthData.videos.map(video => `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition duration-200">
                        <div class="flex space-x-4">
                            <div class="flex-shrink-0">
                                <img src="${video.snippet.thumbnails.medium.url}" alt="${video.snippet.title}" class="w-32 h-24 object-cover rounded-lg">
                            </div>
                            <div class="flex-1 min-w-0">
                                <h3 class="text-lg font-semibold text-gray-800 mb-2 line-clamp-2">${video.snippet.title}</h3>
                                <p class="text-gray-600 text-sm mb-3 line-clamp-3">${video.snippet.description}</p>
                                <div class="flex justify-between items-center">
                                    <p class="text-gray-500 text-xs">‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà: ${new Date(video.snippet.publishedAt).toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                                    <a href="https://www.youtube.com/watch?v=${video.id.videoId}" target="_blank" rel="noopener noreferrer" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition duration-200">‡∏î‡∏π‡πÉ‡∏ô YouTube</a>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            analyticsSection.classList.add('hidden');
            monthlyVideosDetail.classList.remove('hidden');
        }

        backToMonthlyTableBtn.addEventListener('click', () => {
            monthlyVideosDetail.classList.add('hidden');
            analyticsSection.classList.remove('hidden');
        });

        window.showMonthlyVideos = showMonthlyVideos;

        loadYearDataBtn.addEventListener('click', async () => {
            const selectedYear = parseInt(yearSelector.value);
            if (!selectedYear || !currentConfig) {
                showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ', 'error');
                return;
            }

            loadYearDataBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...';
            loadYearDataBtn.disabled = true;

            try {
                const videos = await fetchChannelVideosForYear(currentConfig.apiKey, currentConfig.channelId, selectedYear);
                currentYearVideos = videos;
                currentSelectedYear = selectedYear;
                displayAnalytics(videos);
                const monthlyData = processMonthlyData(videos);
                
                monthlyVideosTable.innerHTML = monthlyData.map((data, index) => `
                    <tr class="${index % 2 === 0 ? 'bg-white' : 'bg-gray-50'}">
                        <td class="px-4 py-3 text-sm text-gray-800">${data.month}</td>
                        <td class="px-4 py-3 text-center text-sm font-medium text-gray-900">${data.count}</td>
                        <td class="px-4 py-3 text-center text-sm text-gray-600">
                            <div class="flex items-center justify-center space-x-2">
                                <div class="w-16 bg-gray-200 rounded-full h-2">
                                    <div class="bg-blue-600 h-2 rounded-full" style="width: ${data.percentage}%"></div>
                                </div>
                                <span>${data.percentage}%</span>
                            </div>
                        </td>
                        <td class="px-4 py-3 text-center">
                            ${data.count > 0 ? `<button onclick="showMonthlyVideos(${JSON.stringify(data).replace(/"/g, '&quot;')})" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm font-medium transition duration-200">‡∏î‡∏π‡∏Ñ‡∏•‡∏¥‡∏õ</button>` : `<span class="text-gray-400 text-sm">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏•‡∏¥‡∏õ</span>`}
                        </td>
                    </tr>
                `).join('');
                
                const totalVideos = videos.length;
                const avgPerMonth = (totalVideos / 12).toFixed(1);
                const maxMonth = monthlyData.reduce((max, current) => current.count > max.count ? current : max);
                const minMonth = monthlyData.reduce((min, current) => current.count < min.count ? current : min);
                
                yearSummary.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="text-center">
                            <h4 class="font-semibold text-blue-800 mb-1">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏õ‡∏µ</h4>
                            <p class="text-2xl font-bold text-blue-600">${totalVideos} ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</p>
                        </div>
                        <div class="text-center">
                            <h4 class="font-semibold text-green-800 mb-1">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h4>
                            <p class="text-2xl font-bold text-green-600">${avgPerMonth} ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</p>
                        </div>
                        <div class="text-center">
                            <h4 class="font-semibold text-purple-800 mb-1">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h4>
                            <p class="text-lg font-bold text-purple-600">${maxMonth.month}</p>
                            <p class="text-sm text-purple-500">${maxMonth.count} ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</p>
                        </div>
                        <div class="text-center">
                            <h4 class="font-semibold text-orange-800 mb-1">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h4>
                            <p class="text-lg font-bold text-orange-600">${minMonth.month}</p>
                            <p class="text-sm text-orange-500">${minMonth.count} ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</p>
                        </div>
                    </div>
                `;
                
                analyticsSection.classList.remove('hidden');
                showStatus(`‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏µ ${selectedYear + 543} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`, 'success');
            } catch (error) {
                console.error('Error loading year data:', error);
                showStatus(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`, 'error');
                analyticsSection.classList.add('hidden');
            } finally {
                loadYearDataBtn.textContent = '‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏µ';
                loadYearDataBtn.disabled = false;
            }
        });

        loadChannelDataBtn.addEventListener('click', async () => {
            const selectedConfigId = channelSelector.value;
            if (!selectedConfigId) {
                showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á YouTube', 'error');
                return;
            }

            const config = allConfigs[selectedConfigId];
            loadChannelDataBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...';
            loadChannelDataBtn.disabled = true;

            try {
                const channelData = await fetchChannelData(config.apiKey, config.channelId);
                currentChannelData = channelData;
                currentConfig = config;
                
                channelDetails.innerHTML = `
                    <div class="text-center">
                        <img src="${channelData.snippet.thumbnails.medium.url}" alt="${channelData.snippet.title}" class="w-24 h-24 rounded-full mx-auto mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">${channelData.snippet.title}</h3>
                        <p class="text-gray-600 text-sm mt-2">${channelData.snippet.description.substring(0, 100)}...</p>
                        <p class="text-gray-500 text-xs mt-2">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${new Date(channelData.snippet.publishedAt).toLocaleDateString('th-TH')}</p>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-blue-800 mb-2">‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</h4>
                        <p class="text-2xl font-bold text-blue-600">${formatNumber(channelData.statistics.subscriberCount)}</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-green-800 mb-2">‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h4>
                        <p class="text-2xl font-bold text-green-600">${formatNumber(channelData.statistics.videoCount)}</p>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-purple-800 mb-2">‡∏¢‡∏≠‡∏î‡∏ß‡∏¥‡∏ß</h4>
                        <p class="text-2xl font-bold text-purple-600">${formatNumber(channelData.statistics.viewCount)}</p>
                    </div>
                `;
                
                channelInfo.classList.remove('hidden');
                generateYearOptions(channelData.snippet.publishedAt);
                yearFilterSection.classList.remove('hidden');
                showStatus('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡πà‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            } catch (error) {
                console.error('Error loading YouTube data:', error);
                showStatus(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`, 'error');
                channelInfo.classList.add('hidden');
                yearFilterSection.classList.add('hidden');
                analyticsSection.classList.add('hidden');
            } finally {
                loadChannelDataBtn.textContent = '‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
                loadChannelDataBtn.disabled = false;
            }
        });

        configForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const channelName = document.getElementById('channelName').value;
            const apiKey = document.getElementById('apiKey').value;
            const channelId = document.getElementById('channelId').value;

            try {
                const newConfig = {
                    channelName, apiKey, channelId,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                await push(configsRef, newConfig);
                configForm.reset();
                showStatus('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Config ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            } catch (error) {
                console.error('Error adding config:', error);
                showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Config', 'error');
            }
        });

        function renderConfigs(configs) {
            if (!configs || Object.keys(configs).length === 0) {
                configList.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Config ‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ
                    </div>
                `;
                return;
            }

            const configsArray = Object.entries(configs).map(([key, value]) => ({ id: key, ...value }));
            configList.innerHTML = configsArray.map(config => `
                <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition duration-200">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">${config.channelName}</h3>
                            <div class="space-y-1 text-sm text-gray-600">
                                <p><span class="font-medium">API Key:</span> ${config.apiKey.substring(0, 20)}...</p>
                                <p><span class="font-medium">Channel ID:</span> ${config.channelId}</p>
                                <p><span class="font-medium">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠:</span> ${new Date(config.createdAt).toLocaleString('th-TH')}</p>
                            </div>
                        </div>
                        <div class="flex space-x-2 ml-4">
                            <button onclick="editConfig('${config.id}', '${config.channelName}', '${config.apiKey}', '${config.channelId}')" class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded text-sm transition duration-200">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                            <button onclick="deleteConfig('${config.id}')" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition duration-200">‡∏•‡∏ö</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        window.deleteConfig = async (configId) => {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö Config ‡∏ô‡∏µ‡πâ?')) {
                try {
                    await remove(ref(database, `youtube-configs/${configId}`));
                    showStatus('‡∏•‡∏ö Config ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                } catch (error) {
                    console.error('Error deleting config:', error);
                    showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö Config', 'error');
                }
            }
        };

        window.editConfig = (configId, channelName, apiKey, channelId) => {
            document.getElementById('channelName').value = channelName;
            document.getElementById('apiKey').value = apiKey;
            document.getElementById('channelId').value = channelId;
            
            const submitButton = configForm.querySelector('button[type="submit"]');
            submitButton.textContent = '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Config';
            submitButton.className = 'w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition duration-200';
            
            if (!document.getElementById('cancelEdit')) {
                const cancelButton = document.createElement('button');
                cancelButton.type = 'button';
                cancelButton.id = 'cancelEdit';
                cancelButton.textContent = '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å';
                cancelButton.className = 'w-full bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-lg transition duration-200 mt-2';
                cancelButton.onclick = cancelEdit;
                configForm.appendChild(cancelButton);
            }
            
            configForm.onsubmit = async (e) => {
                e.preventDefault();
                try {
                    const updatedConfig = {
                        channelName: document.getElementById('channelName').value,
                        apiKey: document.getElementById('apiKey').value,
                        channelId: document.getElementById('channelId').value,
                        updatedAt: new Date().toISOString()
                    };
                    await update(ref(database, `youtube-configs/${configId}`), updatedConfig);
                    showStatus('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Config ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                    cancelEdit();
                } catch (error) {
                    console.error('Error updating config:', error);
                    showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Config', 'error');
                }
            };
        };

        window.cancelEdit = () => {
            configForm.reset();
            const submitButton = configForm.querySelector('button[type="submit"]');
            submitButton.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Config';
            submitButton.className = 'w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition duration-200';
            
            const cancelButton = document.getElementById('cancelEdit');
            if (cancelButton) cancelButton.remove();
            
            configForm.onsubmit = async (e) => {
                e.preventDefault();
                const channelName = document.getElementById('channelName').value;
                const apiKey = document.getElementById('apiKey').value;
                const channelId = document.getElementById('channelId').value;

                try {
                    const newConfig = {
                        channelName, apiKey, channelId,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                    await push(configsRef, newConfig);
                    configForm.reset();
                    showStatus('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Config ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                } catch (error) {
                    console.error('Error adding config:', error);
                    showStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Config', 'error');
                }
            };
        };

        onValue(configsRef, (snapshot) => {
            const configs = snapshot.val();
            allConfigs = configs || {};
            renderConfigs(configs);
        });

        checkLogin();
    </script>
</body>
</html>